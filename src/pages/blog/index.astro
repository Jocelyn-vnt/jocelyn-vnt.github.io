---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import MeshGradientBackground from '../../components/MeshGradientBackground.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';
import { getCollection } from 'astro:content';
import FormattedDate from '../../components/FormattedDate.astro';
import Doctype from '../../components/Doctype.astro';

const posts = (await getCollection('blog')).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<Doctype/>

<MeshGradientBackground />

<main class="flex-grow flex justify-center">
    <div class="w-full">
        <!-- Header -->
        <div class="fixed flex w-full justify-center items-center pt-5 z-50">
            <Header />
        </div>

        <!-- Title Section -->
        <div class="relative flex flex-col items-center pt-32 pb-12">
            <h1 class="text-[248px] font-bold font-anuphan text-white relative" id="portfolio-text">
                Projets
                <span class="absolute text-purple-800 font-alex text-[144px] font-normal bottom-0 right-0" id="design-text">Design</span>
            </h1>
        </div>

        <!-- Filter Section -->
        <section class="flex justify-center px-6 pb-8 relative z-10">
            <div class="flex gap-4 justify-center flex-wrap">
                <button 
                    class="filter-btn active px-6 py-3 bg-white/10 backdrop-blur-lg border border-glass rounded-full text-white font-anuphan font-medium hover:bg-white/20 hover:border-purple-400/50 transition-all duration-300 shadow-glass"
                    data-filter="all"
                >
                    Tout
                </button>
                <button 
                    class="filter-btn px-6 py-3 bg-white/10 backdrop-blur-lg border border-glass rounded-full text-white font-anuphan font-medium hover:bg-white/20 hover:border-purple-400/50 transition-all duration-300 shadow-glass"
                    data-filter="motion-design"
                >
                    Motion Design
                </button>
                <button 
                    class="filter-btn px-6 py-3 bg-white/10 backdrop-blur-lg border border-glass rounded-full text-white font-anuphan font-medium hover:bg-white/20 hover:border-purple-400/50 transition-all duration-300 shadow-glass"
                    data-filter="graphic-design"
                >
                    Graphic Design
                </button>
                <button 
                    class="filter-btn px-6 py-3 bg-white/10 backdrop-blur-lg border border-glass rounded-full text-white font-anuphan font-medium hover:bg-white/20 hover:border-purple-400/50 transition-all duration-300 shadow-glass"
                    data-filter="web-design"
                >
                    Web Design
                </button>
            </div>
        </section>

        <!-- Projects Grid Section - Bento Box Style -->
        <section class="flex justify-center px-6 py-8 relative z-10">
            <div class="w-full max-w-7xl">
                <!-- Grille Bento Box 6 colonnes -->
                <div id="projects-grid" class="grid grid-cols-6 gap-4 auto-rows-auto">
                    {posts.map((post, index) => {
                        // Grille avec beaucoup plus de diversité - patterns optimisés
                        const generateSmartRandomSize = () => {
                            const advancedSizes = [
                                // Grandes pièces marquantes
                                'col-span-4 row-span-3', // Mega format horizontal
                                'col-span-3 row-span-3', // Grande carré
                                'col-span-5 row-span-2', // Super large
                                'col-span-2 row-span-3', // Tour verticale
                                
                                // Formats moyens variés
                                'col-span-3 row-span-2', // Grande horizontale
                                'col-span-2 row-span-2', // Carré moyen
                                'col-span-4 row-span-1', // Bandeau large
                                'col-span-1 row-span-3', // Colonne fine
                                
                                // Petits formats créatifs
                                'col-span-2 row-span-1', // Rectangle moyen
                                'col-span-1 row-span-2', // Verticale courte
                                'col-span-1 row-span-1', // Petit carré
                                'col-span-3 row-span-1', // Bandeau moyen
                                
                                // Formats asymétriques uniques
                                'col-span-5 row-span-1', // Très large fin
                                'col-span-6 row-span-1', // Pleine largeur
                                'col-span-4 row-span-2', // Large rectangle
                                'col-span-5 row-span-3', // Géant horizontal
                            ];
                            
                            // Algorithme de distribution intelligente
                            const seed = (index * 7 + post.data.title.charCodeAt(0) * 3) % advancedSizes.length;
                            return advancedSizes[seed];
                        };
                        
                        const sizeClass = generateSmartRandomSize();
                        
                        // Détecter la catégorie basée sur le titre et le contenu
                        let category = 'graphic-design'; // Catégorie par défaut
                        
                        // Détection pour les projets spécifiques
                        if (post.data.title.toLowerCase().includes('dragon ball') || 
                            post.data.title.toLowerCase().includes('3d')) {
                            category = '3d';
                        } else if (post.data.title.toLowerCase().includes('limoges habitat')) {
                            category = 'motion-design'; // Projet complet avec motion design
                        } else if (post.data.title.toLowerCase().includes('limousin informatique') || 
                                   post.data.title.toLowerCase().includes('web') || 
                                   post.data.title.toLowerCase().includes('stratégie')) {
                            category = 'web-design';
                        } else if (post.data.title.toLowerCase().includes('motion') || 
                                   post.data.title.toLowerCase().includes('animation')) {
                            category = 'motion-design';
                        }
                        
                        return (
                            <div class={`project-card ${sizeClass} relative group overflow-hidden rounded-2xl`} data-category={category}>
                                <a href={`/blog/${post.slug}/`} class="block h-full">
                                    <div class="relative w-full h-full min-h-[180px] overflow-hidden rounded-2xl">
                                        <img 
                                            src={post.data.heroImage} 
                                            alt={post.data.title}
                                            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                                        />
                                        
                                        <!-- Overlay graduel -->
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-60 group-hover:opacity-80 transition-opacity duration-300"></div>
                                        
                                        <!-- Contenu de la carte -->
                                        <div class="absolute inset-0 p-6 flex flex-col justify-end">
                                            <div class="transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                                                <h3 class="text-white font-anuphan font-bold text-lg mb-2 line-clamp-2">
                                                    {post.data.title}
                                                </h3>
                                                <p class="text-white/80 text-sm mb-3 line-clamp-2">
                                                    {post.data.description}
                                                </p>
                                                <div class="flex items-center justify-between">
                                                    <span class="text-white/70 text-xs font-medium">
                                                        <FormattedDate date={post.data.pubDate} />
                                                    </span>
                                                    <span class="text-purple-300 text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                                        Voir le projet →
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Badge catégorie -->
                                        <div class="absolute top-4 left-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                            <span class="px-3 py-1 bg-white/20 backdrop-blur-md rounded-full text-white text-xs font-medium border border-white/30">
                                                {category === 'motion-design' ? 'Motion Design' : 
                                                 category === 'graphic-design' ? 'Graphic Design' : 
                                                 category === '3d' ? '3D' :
                                                 'Web Design'}
                                            </span>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        );
                    })}
                </div>
            </div>
        </section>
    </div>
</main>

<style>
    /* Animation pour les cartes */
    .project-card {
        transition: transform 0.3s ease, opacity 0.3s ease;
    }
    
    .project-card.hidden {
        opacity: 0;
        transform: scale(0.8);
        pointer-events: none;
    }
    
    /* Style pour les boutons de filtre actifs */
    .filter-btn.active {
        background: rgba(168, 85, 247, 0.3);
        border-color: rgba(168, 85, 247, 0.5);
        color: #e879f9;
        box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
    }
    
    /* Responsive amélioré pour les nouvelles tailles */
    @media (max-width: 1200px) {
        #projects-grid {
            grid-template-columns: repeat(5, 1fr);
        }
        .col-span-6 { grid-column: span 5; }
        .col-span-5 { grid-column: span 4; }
        .col-span-4 { grid-column: span 3; }
        .col-span-3 { grid-column: span 2; }
        .col-span-2 { grid-column: span 2; }
        .col-span-1 { grid-column: span 1; }
    }
    
    @media (max-width: 1024px) {
        #projects-grid {
            grid-template-columns: repeat(4, 1fr);
        }
        .col-span-6, .col-span-5 { grid-column: span 4; }
        .col-span-4 { grid-column: span 3; }
        .col-span-3 { grid-column: span 2; }
        .col-span-2 { grid-column: span 2; }
        .col-span-1 { grid-column: span 1; }
        /* Limiter la hauteur sur tablet */
        .row-span-3 { grid-row: span 2; }
    }
    
    @media (max-width: 768px) {
        #projects-grid {
            grid-template-columns: repeat(3, 1fr);
        }
        .col-span-6, .col-span-5, .col-span-4 { grid-column: span 3; }
        .col-span-3, .col-span-2 { grid-column: span 2; }
        .col-span-1 { grid-column: span 1; }
        /* Réduire les hauteurs sur mobile */
        .row-span-3 { grid-row: span 2; }
        .row-span-2 { grid-row: span 1; }
    }
    
    @media (max-width: 580px) {
        #projects-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        .col-span-6, .col-span-5, .col-span-4, .col-span-3, .col-span-2 { 
            grid-column: span 2; 
        }
        .col-span-1 { grid-column: span 1; }
        /* Tout en hauteur 1 sur très petit écran */
        .row-span-3, .row-span-2 { 
            grid-row: span 1; 
        }
    }
    
    /* Effet de ligne de texte clampé */
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>


<svg width="0" height="0">
    <filter id="gooey">
        <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
        <feColorMatrix in="blur" mode="matrix" values="
            1 0 0 0 0
            0 1 0 1 0
            0 0 1 0 0
            1 0 0 20 -10" result="gooey" />
        <feComposite in="SourceGraphic" in2="gooey" operator="atop" />
    </filter>
</svg>

</body>
</html>